
/* 
## Working, it builds
node{
    def MAVENHOME = tool name: 'maven3.8.6'
	
	stage('CheckOutCode') 
	{
	    git branch: 'development', credentialsId: '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', url:'https://github.com/austinssdevops/maven-web-application.git'
	}
	
	stage('Build') {
	    sh "${MAVENHOME}/bin/mvn package"
	}
}

*/

node{
    
    echo "The JobName is: ${env.JOB_Name}"
    echo "The node Name is: ${env.NODE_NAME}"
    echo "The Build Number is: ${env.BUILD_NUMBER}"
    
    properties([buildDiscarder(logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '1000', numToKeepStr: '15')), [$class: 'JobLocalConfiguration', changeReasonComment: '']])
	
	def MAVENHOME = tool name: 'maven3.8.6'
	
	stage('CheckOutCode') 
	{
		git branch: 'development', credentialsId: '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', url:'https://github.com/austinssdevops/maven-web-application.git'
	}
	
	stage('Build') 
	{
		sh "${MAVENHOME}/bin/mvn package"
	}
	
	stage('ExecuteSonarQubeReport')
	{
	    sh "${MAVENHOME}/bin/mvn clean sonar:sonar"
	}
	
	stage('UploadArtifactsIntoNexus')
	{
	   sh "${MAVENHOME}/bin/mvn clean deploy"
	}
	
	stage('DeployAppIntoTomcatServer') {
	   // sshagent([<AgentID>])  # if it's remote server
	   // sh "scp target/maven-web-application.war  <userInRemoteMachine>@AA.BB.CC.DD:<webappsDir i.e /opt/apache-tomcat-10.0.27/webapps/>"  # if it's remote server
	   sh  "cp target/maven-web-application.war /opt/apache-tomcat-10.0.27/webapps/"
	}
}
